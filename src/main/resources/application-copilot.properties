# GitHub Copilot Style Configuration
# Philosophy: Pragmatic and developer-focused with quick wins
# Approach: Sensible defaults with clear comments for easy customization
# Trade-offs: Balance between "just works" and performance optimization

# Application
spring.application.name=system-design-experiment

# ==========================================
# ACTUATOR - Developer-friendly defaults
# ==========================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=always
management.metrics.tags.application=${spring.application.name}

# Enable useful metrics without overwhelming developers
management.metrics.enable.jvm.memory=true
management.metrics.enable.jvm.threads=true
management.metrics.enable.system.cpu=true
management.metrics.enable.hikaricp=true
management.metrics.enable.jdbc=true

# Request metrics with common percentiles
management.metrics.web.server.request.autotime.enabled=true
management.metrics.web.server.request.autotime.percentiles=0.5,0.95,0.99

# ==========================================
# DATABASE - Environment-aware configuration
# ==========================================
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:system_design_db}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:password}
spring.datasource.driver-class-name=org.postgresql.Driver

# ==========================================
# CONNECTION POOL - Good defaults that scale
# ==========================================
# These values work well for most applications
# Adjust based on your load testing results
spring.datasource.hikari.pool-name=PostgresHikariCP
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.maximum-pool-size=30
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.auto-commit=true

# Enable leak detection in dev/test environments
# Set LEAK_DETECTION=0 in production for performance
spring.datasource.hikari.leak-detection-threshold=${LEAK_DETECTION:30000}

# ==========================================
# JPA / HIBERNATE - Practical settings
# ==========================================
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=${SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=true

# Enable batching for better performance
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# ==========================================
# FLYWAY - Simple migration setup
# ==========================================
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration
spring.flyway.clean-on-validation-error=false

spring.sql.init.mode=never

# ==========================================
# SERVER - Sensible thread pool sizing
# ==========================================
# Default of 200 threads is fine for most apps
# Increase if you see thread starvation in metrics
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10

# Enable compression to reduce bandwidth
server.compression.enabled=true
server.compression.mime-types=application/json,text/html,text/xml,text/plain

# ==========================================
# GRACEFUL SHUTDOWN - Important for k8s/cloud
# ==========================================
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s

# ==========================================
# LOGGING - Development-friendly
# ==========================================
logging.level.root=INFO
logging.level.com.nrjsingh1.system_design_experiment=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=DEBUG

# ==========================================
# QUICK TIPS FOR CUSTOMIZATION
# ==========================================
# 1. For higher throughput: increase maximum-pool-size to 50-100
# 2. For lower latency: reduce connection-timeout to 10000
# 3. For memory constraints: reduce maximum-pool-size to 15-20
# 4. For production: set logging levels to WARN
# 5. For debugging: enable spring.jpa.show-sql=true
